const arrayTeam1 = [{"id":10151,"name":"Diego Alves Carreira","age":37,"number":null,"position":"Goalkeeper","photo":"https://media.api-sports.io/football/players/10151.png"},{"id":306210,"name":"Matheus Cunha","age":21,"number":null,"position":"Goalkeeper","photo":"https://media.api-sports.io/football/players/306210.png"},{"id":123759,"name":"Hugo Souza","age":23,"number":null,"position":"Goalkeeper","photo":"https://media.api-sports.io/football/players/123759.png"},{"id":195099,"name":"João Fernando","age":21,"number":null,"position":"Goalkeeper","photo":"https://media.api-sports.io/football/players/195099.png"},{"id":10156,"name":"Rodrigo Caio","age":29,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10156.png"},{"id":15789,"name":"Patrick da Silva Ferreira Souza","age":22,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/15789.png"},{"id":266019,"name":"Diego Damasceno dos Santos","age":19,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/266019.png"},{"id":10157,"name":"Rodinei","age":30,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10157.png"},{"id":352369,"name":"Richard dos Santos de Almeida","age":19,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/352369.png"},{"id":349001,"name":"Wesley Vinícius França Lima","age":19,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/349001.png"},{"id":10161,"name":"Matheus França Silva","age":22,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10161.png"},{"id":1344,"name":"M. Isla","age":34,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/1344.png"},{"id":34,"name":"Filipe Luís","age":37,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/34.png"},{"id":2283,"name":"David Luiz","age":35,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/2283.png"},{"id":237160,"name":"Santiago Ocampos Ibarra","age":20,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/237160.png"},{"id":10124,"name":"Léo Pereira","age":26,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10124.png"},{"id":67944,"name":"Ramon Ramos Lima","age":21,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/67944.png"},{"id":10163,"name":"Renê","age":30,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10163.png"},{"id":195102,"name":"Gabriel Rodrigues Noga","age":20,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/195102.png"},{"id":340067,"name":"Cleiton Santana dos Santos","age":19,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/340067.png"},{"id":9992,"name":"Gustavo Henrique","age":29,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/9992.png"},{"id":2612,"name":"G. De Arrascaeta","age":28,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/2612.png"},{"id":10168,"name":"Éverton Ribeiro","age":33,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/10168.png"},{"id":80530,"name":"Yuri de Oliveira","age":21,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/80530.png"},{"id":311157,"name":"Matheus França de Oliveira","age":18,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/311157.png"},{"id":195103,"name":"João Victor Gomes da Silva","age":21,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/195103.png"},{"id":352371,"name":"Victor Hugo","age":18,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/352371.png"},{"id":352372,"name":"Matheus Gonçalves","age":17,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/352372.png"},{"id":899,"name":"Andreas Pereira","age":26,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/899.png"},{"id":322067,"name":"Igor","age":19,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/322067.png"},{"id":22231,"name":"Thiago Maia","age":25,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/22231.png"},{"id":352373,"name":"Kayke David","age":19,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/352373.png"},{"id":10171,"name":"Diego Ribas da Cunha","age":37,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/10171.png"},{"id":10173,"name":"Willian Arão","age":30,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/10173.png"},{"id":10321,"name":"Pedro","age":25,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/10321.png"},{"id":10174,"name":"Gabriel Barbosa","age":26,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/10174.png"},{"id":10177,"name":"Vitinho","age":29,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/10177.png"},{"id":266020,"name":"Ryan Luka Cordeiro de Souza","age":19,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/266020.png"},{"id":311158,"name":"Werton de Almeida Rêgo","age":19,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/311158.png"},{"id":306216,"name":"Mateus Dias Lima","age":18,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/306216.png"},{"id":54716,"name":"Thiago Fernandes Rodrigues","age":21,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/54716.png"},{"id":325717,"name":"André Luiz Inácio da Silva","age":20,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/325717.png"},{"id":237103,"name":"Lázaro Vinicius Marques","age":20,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/237103.png"},{"id":352374,"name":"Petterson Novaes Reis","age":18,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/352374.png"},{"id":10180,"name":"Bruno Henrique","age":32,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/10180.png"},{"id":10506,"name":"Marinho","age":32,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/10506.png"}];
const arrayTeam2 = [{"id":41227,"name":"Muriel Gustavo Becker","age":35,"number":null,"position":"Goalkeeper","photo":"https://media.api-sports.io/football/players/41227.png"},{"id":293555,"name":"Pedro Rangel","age":22,"number":null,"position":"Goalkeeper","photo":"https://media.api-sports.io/football/players/293555.png"},{"id":10298,"name":"Marcos Felipe","age":26,"number":null,"position":"Goalkeeper","photo":"https://media.api-sports.io/football/players/10298.png"},{"id":10080,"name":"Fábio Deivson Lopes Maciel","age":42,"number":null,"position":"Goalkeeper","photo":"https://media.api-sports.io/football/players/10080.png"},{"id":50081,"name":"David Braz","age":35,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/50081.png"},{"id":10552,"name":"Danilo Barcelos","age":31,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10552.png"},{"id":61809,"name":"Luccas Claro","age":31,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/61809.png"},{"id":105501,"name":"Cris Silva","age":29,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/105501.png"},{"id":10351,"name":"David de Duarte Macedo","age":27,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10351.png"},{"id":70422,"name":"Luan de Freitas Molarinho Chagas","age":21,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/70422.png"},{"id":10301,"name":"Matheus Ferraz","age":37,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10301.png"},{"id":10306,"name":"Marcílio Florencio Mota Filho","age":25,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10306.png"},{"id":63949,"name":"M. Pineida","age":30,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/63949.png"},{"id":10309,"name":"Marlon Rodrigues Xavier","age":25,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10309.png"},{"id":10237,"name":"Manoel","age":32,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10237.png"},{"id":10267,"name":"Samuel Xavier","age":32,"number":null,"position":"Defender","photo":"https://media.api-sports.io/football/players/10267.png"},{"id":13708,"name":"Jhon Adolfo Arias Andrade","age":25,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/13708.png"},{"id":133194,"name":"Lucas Felipe Calegari","age":20,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/133194.png"},{"id":10311,"name":"Ganso","age":33,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/10311.png"},{"id":10348,"name":"Yago Felipe da Costa Rocha","age":27,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/10348.png"},{"id":9883,"name":"Nathan Allan de Souza","age":26,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/9883.png"},{"id":280245,"name":"Matheus Martinelli Lima","age":21,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/280245.png"},{"id":10128,"name":"Wellington","age":31,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/10128.png"},{"id":9929,"name":"Felipe Melo de Carvalho","age":39,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/9929.png"},{"id":10396,"name":"Gustavo Nonato Santana","age":24,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/10396.png"},{"id":305817,"name":"Gabriel Teixeira Aragão","age":21,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/305817.png"},{"id":265784,"name":"André Trindade da Costa Neto","age":21,"number":null,"position":"Midfielder","photo":"https://media.api-sports.io/football/players/265784.png"},{"id":297522,"name":"John Kennedy Batista de Souza","age":20,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/297522.png"},{"id":13523,"name":"G. Cano","age":34,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/13523.png"},{"id":10104,"name":"Frederico Chaves Guedes","age":39,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/10104.png"},{"id":10527,"name":"Caio Paulista","age":24,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/10527.png"},{"id":9936,"name":"Willian","age":36,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/9936.png"},{"id":305821,"name":"Matheus Martins Silva dos Santos","age":19,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/305821.png"},{"id":265785,"name":"Luiz Henrique André Rosa da Silva","age":21,"number":null,"position":"Attacker","photo":"https://media.api-sports.io/football/players/265785.png"}];
const positions = ['Defender','Midfielder','Attacker'];
const paramGame = ['inicio','fim','reinicio'];
const nameTeam1 = 'Flamengo';
const nameTeam2 = 'Fluminense';
const defendersToAttackersPhrases = ['avança e lança para', 'lança para' , 'avança e cruza para' ];
const midfieldersToAttackersPhrases = ['passa para', 'cruza para'];
let control = paramGame[0];
let placar1 = 0;
let placar2 = 0;
let numeroJogadas = 0;
let audioControl = 0;
const delayTimeGol = 8800;
const audioGol = new Audio('audios/gol.mp3');

//CONSTANTE QUE DEFINE A QUANTIDADE DE LINHAS DO SPEAKER
const velocityGame = 3;
//CONSTANTE QUE DEFINE A VELOCIDADE DO SPEAKER
const delayTime = 300;
const limiteJogadas = 90;



const defenders1 = arrayTeam1.filter((element)=>element.position==='Defender');
const midfilders1 = arrayTeam1.filter((element)=>element.position==='Midfielder');
const attackers1 = arrayTeam1.filter((element)=>element.position==='Attacker');
const goalkeepers1 = arrayTeam1.filter((element)=>element.position==='Goalkeeper');

const defenders2 = arrayTeam2.filter((element)=>element.position==='Defender');
const midfilders2 = arrayTeam2.filter((element)=>element.position==='Midfielder');
const attackers2 = arrayTeam2.filter((element)=>element.position==='Attacker');
const goalkeepers2 = arrayTeam2.filter((element)=>element.position==='Goalkeeper');

const randomIndex = (array) => Math.floor(Math.random()*array.length);

const tactics = '4-4-2'
let paramTactic = '';



let team1;
const defendersLineUp1 =[];
const midfieldersLineUp1 = [];
const attackersLineUp1 =[];

let team2;
const defendersLineUp2 =[];
const midfieldersLineUp2 = [];
const attackersLineUp2 =[];

let numberPlayer = 2;


function createLineTeam(team,players,param,teamParam){
  control = 0;
 while(control<param){
     const element = players[randomIndex(players)]

     if(!team.includes(element)){
        team.push(element);
        control+=1;
     }

    }
  team.forEach((element)=>{
    element.team = teamParam;
    element.number = numberPlayer;
    numberPlayer +=1;
  })
}

function createTeam1(tactic) {
    numberPlayer = 2;
    let paramTactic = tactic.split('-');
    
    createLineTeam(defendersLineUp1,defenders1,paramTactic[0],1);
    createLineTeam(midfieldersLineUp1,midfilders1,paramTactic[1],1);
    createLineTeam(attackersLineUp1,attackers1,paramTactic[2],1);
    const goalkeeper1 = goalkeepers1[randomIndex(goalkeepers1)];
    goalkeeper1.team = 1;
    goalkeeper1.number = 1;
    team1 = [goalkeeper1,...defendersLineUp1,...midfieldersLineUp1,...attackersLineUp1];
    
}
function createTeam2(tactic) {
    numberPlayer = 2;
    let paramTactic = tactic.split('-');
    
    createLineTeam(defendersLineUp2,defenders2,paramTactic[0],2);
    createLineTeam(midfieldersLineUp2,midfilders2,paramTactic[1],2);
    createLineTeam(attackersLineUp2,attackers2,paramTactic[2],2);
    const goalkeeper2 = goalkeepers2[randomIndex(goalkeepers2)];
    goalkeeper2.team = 2;
    goalkeeper2.number = 1;
    team2 = [goalkeeper2,...defendersLineUp2,...midfieldersLineUp2,...attackersLineUp2];
}

 function moveGoalkeeper(player){
 
 let lineFuture = positions[randomIndex(positions)];
 if(lineFuture ==='Defender'){
    let receptorPlayer;
     if(player.team===1){
      receptorPlayer = defendersLineUp1[randomIndex(defendersLineUp1)]
     }else{
       receptorPlayer = defendersLineUp2[randomIndex(defendersLineUp2)]
     }
     const msg = `${player.name} passa a bola para ${receptorPlayer.name}`
     console.log(msg); 
     return {msg,receptorPlayer};
 }
 if(lineFuture ==='Midfielder'){
     let receptorPlayer;
    if(player.team===1){
        receptorPlayer = midfieldersLineUp1[randomIndex(midfieldersLineUp1)]
      }else{
        receptorPlayer = midfieldersLineUp2[randomIndex(midfieldersLineUp2)];
      };
    const msg = `${player.name} lança a bola para ${receptorPlayer.name}`
    console.log(msg);
    return {msg,receptorPlayer};
}
if(lineFuture ==='Attacker'){
    let receptorPlayer;
    if(player.team===1){
        receptorPlayer = attackersLineUp1[randomIndex(attackersLineUp1)]
      }else{
        receptorPlayer = attackersLineUp2[randomIndex(attackersLineUp2)]
      }
    const msg = `${player.name} lança a bola para ${receptorPlayer.name}`
    console.log(msg);
    return {msg,receptorPlayer};
}

}

function moveDefender(player){
  let lineFuture = positions[randomIndex(positions)];
  if(lineFuture ==='Defender' ){
        let receptorPlayer;
        if(player.team===1){
            const defendersFiltred = defendersLineUp1.filter((element)=> element.id !== player.id);
            const randIndex = randomIndex(defendersFiltred);
            receptorPlayer = defendersFiltred[randIndex];;
          }else{
            const defendersFiltred = defendersLineUp2.filter((element)=> element.id !== player.id);
            const randIndex = randomIndex(defendersFiltred);
            receptorPlayer = defendersFiltred[randIndex];;
          }
        const msg = `${player.name} passa a bola para ${receptorPlayer.name}`
        console.log(msg); 
        return {msg,receptorPlayer};
    }
    if(lineFuture ==='Midfielder'){
        let receptorPlayer;
        if(player.team===1){
            receptorPlayer = midfieldersLineUp1[randomIndex(midfieldersLineUp1)]
          }else{
            receptorPlayer = midfieldersLineUp2[randomIndex(midfieldersLineUp2)];
          };
        const msg = `${player.name} passa a bola para ${receptorPlayer.name}`;
        return {msg,receptorPlayer};
    }
    if(lineFuture ==='Attacker'){
        let receptorPlayer;
    if(player.team===1){
        receptorPlayer = attackersLineUp1[randomIndex(attackersLineUp1)]
      }else{
        receptorPlayer = attackersLineUp2[randomIndex(attackersLineUp2)]
      }
        const phrase = defendersToAttackersPhrases[randomIndex(defendersToAttackersPhrases)];
        const msg = `${player.name} ${phrase} ${receptorPlayer.name}`
        console.log(msg);
        return {msg,receptorPlayer};
    }
}

function moveMieldfilder(player,team){
  let lineFuture = positions[randomIndex(positions)];
  if(lineFuture ==='Defender' ){
        let receptorPlayer;
        if(player.team===1){
         receptorPlayer = defendersLineUp1[randomIndex(defendersLineUp1)]
        }else{
          receptorPlayer = defendersLineUp2[randomIndex(defendersLineUp2)]
        }
        const msg = `${player.name} passa a bola para ${receptorPlayer.name}`
        console.log(msg); 
        return {msg,receptorPlayer};
    }
    if(lineFuture ==='Midfielder'){
        let receptorPlayer;
        if(player.team===1){
            const midfielderFiltred = midfieldersLineUp1.filter((element)=> element.id !== player.id);
            const randIndex = randomIndex(midfielderFiltred);
            receptorPlayer = midfielderFiltred[randIndex];
          }else{
            const midfielderFiltred = midfieldersLineUp2.filter((element)=> element.id !== player.id);
            const randIndex = randomIndex(midfielderFiltred);
            receptorPlayer = midfielderFiltred[randIndex];
          }
        const msg = `${player.name} passa a bola para ${receptorPlayer.name}`
        console.log(msg);
        return {msg,receptorPlayer};
    }
    if(lineFuture ==='Attacker'){
        let receptorPlayer;
       if(player.team===1){
        receptorPlayer = attackersLineUp1[randomIndex(attackersLineUp1)]
        }else{
        receptorPlayer = attackersLineUp2[randomIndex(attackersLineUp2)]
        }
       const msg = `${player.name} passa a bola para ${receptorPlayer.name}`
        console.log(msg);
        return {msg,receptorPlayer};
    }
}

function moveAttacker(player){
    let receptorPlayer = player;
    const moves = ['passe','chute'];
    const action = moves[randomIndex(moves)];
    const goal = Math.floor(Math.random()*10);
    if(action ==='passe'){
        if(player.team===1){
            const attackersFiltred = attackersLineUp1.filter((element)=> element.id !== player.id);
            // console.log(attackersFiltred);
            const randIndex = randomIndex(attackersFiltred);
            // console.log(randomIndex);
            receptorPlayer = attackersFiltred[randIndex];

            // console.log(receptorPlayer);
          }else{
            const attackersFiltred = attackersLineUp2.filter((element)=> element.id !== player.id);
            // console.log(attackersFiltred);
            const randIndex = randomIndex(attackersFiltred);
            // console.log(randomIndex);
            receptorPlayer = attackersFiltred[randIndex];
            // console.log(receptorPlayer);
          }
          if (!receptorPlayer) {
            receptorPlayer = player;
            const msg = `${player.name} parte para cima, correndo em direção ao gol.`
          }else{   
        const msg = `${player.name} toca a bola para ${receptorPlayer.name}`
          }
        const msg = `${player.name} toca a bola para ${receptorPlayer.name}`
        console.log(msg);
        return {msg,receptorPlayer};
    }
    if(action ==='chute'){
      if(goal>=8){
          const msg = `Goooolllllll de ${player.name} aos ${numeroJogadas} minutos de jogo!`;
         
          if(player.team===1){
              placar1+=1;
          }else{
              placar2+=1;
          }
          control = 'reinicio';
          audioControl = 1;
          console.log(msg);
          console.log(`Flamengo ${placar1} X ${placar2} Fluminense`);
          let receptorPlayer = player;
          placar();
          return {msg,receptorPlayer};
      }
       receptorPlayer = team2.find((element)=>element.position==='Goalkeeper');

      if(player.team === 2){
         receptorPlayer = team1.find((element)=>element.position==='Goalkeeper');
      }
      if(goal<=3){
          const msg = `${player.name} chuta para fora!!!`
          return {msg, receptorPlayer};
      }
        
      const msg = `${player.name} chuta..... e defende ${receptorPlayer.name}`;
      
    return {msg, receptorPlayer};
    }

}

async function initMatchTeam1(){
    const attacker = attackersLineUp1[randomIndex(attackersLineUp1)];
    const midfielder = midfieldersLineUp1[randomIndex(midfieldersLineUp1)];
    const defender = defendersLineUp1[randomIndex(defendersLineUp1)];
    const goalkeeper = team1.find((element)=>element.position ==='Goalkeeper');
    console.log(`Saida de bola com ${attacker.name} que passa para ${midfielder.name} que toca para ${defender.name} que atrasa para ${goalkeeper.name}`);
    initGoalKeeper1(goalkeeper);
    
}

async function initGoalkeeper2(player){
    console.log('Bola com o Fluminense');
    console.log(`${numeroJogadas} minutos de jogo`);
    let result = moveGoalkeeper(player);
    while(control !=='fim' && numeroJogadas <= limiteJogadas){
    await renderPlay(result);
    numeroJogadas += velocityGame;
    if(result.receptorPlayer.position === 'Defender'){
       // console.log('defesa');
       result = moveDefender(result.receptorPlayer,team2);
       await renderPlay(result);
    }else if(result.receptorPlayer.position==='Midfielder'){
       // console.log('meio');
        result = moveMieldfilder(result.receptorPlayer,team2);
        await renderPlay(result);
    }else{
       result = moveAttacker(result.receptorPlayer,team2);
       await renderPlay(result);
       if(audioControl===1){
          console.log('play audio');
          
          audioGol.play();
          await delay(delayTimeGol);
          
         audioControl=0;
       }
       if(result.receptorPlayer.team===1){
        result = moveGoalkeeper(result.receptorPlayer);
        await renderPlay(result);
       }
       if(control==='reinicio'){
        initMatchTeam1();
       }
    }
}

if(numeroJogadas > limiteJogadas || numeroJogadas === limiteJogadas){
  endMatch();
}

}


function initTeam2(){
    const attacker = attackersLineUp2[randomIndex(attackersLineUp2)];
    const midfielder = midfieldersLineUp2[randomIndex(midfieldersLineUp2)];
    const defender = defendersLineUp2[randomIndex(defendersLineUp2)];
    console.log(`Saida de bola com ${attacker.name} que passa para ${midfielder.name} que toca para ${defender.name}`);
    initGoalkeeper2(defender);
}

async function initGoalKeeper1(player){
    console.log('Bola com o Flamengo');
    console.log(`${numeroJogadas} minutos de jogo`);
    let result = moveGoalkeeper(player);
    await renderPlay(result);
    while(control !=='reinicio' && numeroJogadas  <= limiteJogadas){
    numeroJogadas+=velocityGame;
    if(result.receptorPlayer.position === 'Defender'){
       result = moveDefender(result.receptorPlayer,team1);
       await renderPlay(result);
    }else if(result.receptorPlayer.position==='Midfielder'){
        result = moveMieldfilder(result.receptorPlayer,team1);
        await renderPlay(result);
    }else{
       result = moveAttacker(result.receptorPlayer,team1);
       await renderPlay(result);
       if(audioControl===1){
        console.log('play audio');
        
        audioGol.play();
        await delay(delayTimeGol);
        
       audioControl=0;
     }
       if(result.receptorPlayer.team===2){
        result = moveGoalkeeper(result.receptorPlayer);
        await renderPlay(result);
       }
       if(control==='reinicio'){
        initTeam2();
       }
       
    }
}

if(numeroJogadas > limiteJogadas || numeroJogadas === limiteJogadas){
  endMatch();
}
}

//Função para criar um delay
const delay = (time) => new Promise(resolve => setTimeout(resolve, time));


async function renderPlay( param ) {
  const htmlTest = document.getElementById('speaker-container');
  const speakerText = document.createElement('p');
  speakerText.innerText = param.msg;
  const imagemJogador = document.createElement('img');
  imagemJogador.src = param.receptorPlayer.photo;
  await delay(delayTime).then(() => { console.log(""); });
  htmlTest.innerHTML = '';
  //htmlTest.innerText = param.msg;
  htmlTest.appendChild(imagemJogador);
  htmlTest.appendChild(speakerText);
}

function placar(){
  const placar = document.getElementById('placar');
  const placarText = document.createElement('span');
  placarText.innerText = `${nameTeam1} ${placar1} X ${placar2} ${nameTeam2}`
  placar.innerHTML = '';
  placar.appendChild(placarText);
}


//Cria a linha da escalação
function liLineUp(ol, text){
  const liLineUp = document.createElement('li');
  liLineUp.textContent = text;
  ol.appendChild(liLineUp);
}

//Cria a ol com a escalação de um time
function olLineUp(team){
  const olContainer = document.getElementById('line-up-container');
  const olLineUp = document.createElement('ol');
  team.forEach(element => {
    const text = `${element.name}`;
    liLineUp(olLineUp,text);
  });
  olContainer.appendChild(olLineUp);
}

function endMatch(){
  console.log('FIM DE JOGO');
  const htmlTest = document.getElementById('speaker-container');
  const speakerText = document.createElement('p');
  speakerText.innerText = 'Termina a partida!!!';
  const imagemJogador = document.createElement('img');
  imagemJogador.src = 'img/end-match.jpg';
  htmlTest.innerHTML = '';
  //htmlTest.innerText = param.msg;
  htmlTest.appendChild(imagemJogador);
  htmlTest.appendChild(speakerText);
  const btnInitMatch = document.getElementById('begin-match');
  btnInitMatch.innerText ='Jogar Novamente';
}



// createTeam1('4-4-2');
// createTeam2('4-4-2');
// initMatchTeam1();
// array2.forEach(element => {
//   console.log(element.name + element.id)  
// });
async function initMatch(){
  const htmlTest = document.getElementById('speaker-container');
  console.log(htmlTest.innerHTML);
  if(htmlTest.innerText !== ''){
    console.log(htmlTest.innerText + 'click');
    location.reload();
  }
  placar();
  createTeam1('4-4-2');
  olLineUp(team1);
  createTeam2('4-4-2');
  olLineUp(team2);
  await initMatchTeam1();
 
}

function addEventListener(){
  const btnInitMatch = document.getElementById('begin-match');
  btnInitMatch.addEventListener('click',initMatch);
}

window.onload = async () => {
 addEventListener(); 
}